<!DOCTYPE html>
<html>
<!-------------------head part---------------->
<head lang="en">
	<meta charset="UTF-8">
	<title>VIMMS dashboard</title>
    <script type="text/javascript" src="d3/d3.js"></script>
    <script type="text/javascript" src="ajax.js"></script>
    <link type="text/css" rel="stylesheet" href="dashboard.css">

</head>
<!------------------body part----------------->
<body>
<!------------------header part--------------->
    <header id="top_header">
        <!-- left side-->
        <span id="LOGO"><span id="LOGO_white">V I</span> M M S</span>
        <!-- right side-->
        <div id="LOGO_table">
            <div id="LOGO_row">
                <div id="LOGO_message" class="LOGO_cell">
                    <img id="top_mes" src="image/top_mes.png" height="24"
                         onmouseover="top_mes_over();" onmouseout="top_mes_out();">
                </div>
                <div id="LOGO_email" class="LOGO_cell">
                    <img id="top_email" src="image/top_email.png" height="24"
                         onmouseover="top_email_over();" onmouseout="top_email_out();">
                </div>
                <div id="LOGO_person" class="LOGO_cell">
                    <span id="person">YANG YU</span>
                </div>
                <div id="LOGO_menu" class="LOGO_cell">
                    <img id="top_menu" src="image/top_menu.png" height="24"
                         onmouseover="top_menu_over();" onmouseout="top_menu_out();">
                </div>
            </div>
        </div>
    </header>
<!----------------navigator part------------------>
<div id="navigator">
    <div id="navi_ul">
        <!-- menu part-->
        <div id="none">
            <img id="none_img" src="image/nav_menu.png" height="24">
        </div>
        <!-- search part-->
        <div id="search">
            <input type="text" id="input_search" placeholder="Search...">
            <img src="image/nav_search.png" height="12">
        </div>
        <!-- user resources part-->
        <div id="resources">
            <div id="DashBoard" class="resources_row">
                <div class="resources_cell cell_img"><img src="image/nav_home.png" height="24"></div>
                <div class="resources_cell cell_word">Dashboard</div>
                <div class="resources_cell cell_res"><</div>
            </div>
            <div id="VM1" class="resources_row">
                <div class="resources_cell cell_img"><img src="image/nav_vm.png" height="24"></div>
                <div class="resources_cell cell_word">PM1</div>
                <div class="resources_cell cell_res"><</div>
            </div>
            <div id="VM2" class="resources_row" style="background-color: red">
                <div class="resources_cell cell_img"><img src="image/nav_vm.png" height="24"></div>
                <div class="resources_cell cell_word">PM2</div>
                <div class="resources_cell cell_res"><</div>
            </div>
            <div id="VM3" class="resources_row">
                <div class="resources_cell cell_img"><img src="image/nav_vm.png" height="24"></div>
                <div class="resources_cell cell_word">VM1</div>
                <div class="resources_cell cell_res"><</div>
            </div>
            <div id="VM4" class="resources_row">
                <div class="resources_cell cell_img"><img src="image/nav_vm.png" height="24"></div>
                <div class="resources_cell cell_word">VM2</div>
                <div class="resources_cell cell_res"><</div>
            </div>

        </div>
    </div>
</div>
<!---------------------------panel part--------------------------->
<div id="PANEL">
    <div id="PANEL_outline">
        <!-- --------------------header----------------------------------->
        <header id="PANEL_header">
            <span id="PANEL_header_word">PM2</span>
            <span id="PANEL_header_word2">statistics and more</span>
            <img src="image/panel_config.png" id="PANEL_header_img">
        </header>
        <!-- ------------------------navigator------------------------->
        <div id="PANEL_navigator">
            <span id="PANEL_nav_path">
                <img src="image/panel_home.png" id="PANEL_path_img" height="16">
                <span id="PANEL_path_word">Home  >  PM2</span>
            </span>
            <span id="PANEL_calendar">
                <img src="image/panel_calendar.png" id="PANEL_cal_img" height="16">
                <span id="PANEL_cal_word">Date</span>
                <img src="image/panel_cal_down.png" id="PANEL_cal_img2" height="16">
            </span>

        </div>

        <!-- ---------------------chart table----------------------------------->
        <div id="PANEL_chart">

                <div id="secondrow_chart1" class="secondrow_cell">
                    <svg id="chart_cpu"></svg>
                </div>
                <div id="secondrow_chart2" class="secondrow_cell">
                    <svg id="chart_mem"></svg>
                </div>
                <div id="secondrow_chart3" class="secondrow_cell">
                    <svg id="chart_net"></svg>
                </div>

        </div>
    </div>

</div>

<script type="text/javascript">
//-----------------------------hover process----------------------------------------
    function top_mes_over(){
        document.getElementById("top_mes").src = "image/top_mes2.png";
    }

    function top_mes_out(){

        document.getElementById("top_mes").src = "image/top_mes.png";
    }

    function top_email_over(){
        document.getElementById("top_email").src = "image/top_email2.png";
    }

    function top_email_out(){

        document.getElementById("top_email").src = "image/top_email.png";
    }


    function top_menu_over(){
        document.getElementById("top_menu").src = "image/top_menu2.png";
    }

    function top_menu_out(){

        document.getElementById("top_menu").src = "image/top_menu.png";
    }
//---------------------chart cpu----------------------------------------------------
var padding = 30;
var head_height = 20;
var chart1_title = "CPU performance";
var chart1_subtitle = "%";
var chartm_title = "Mem performance";
var chartm_subtitle = "GB";
var chartn_title = "Network performance";
var chartn_subtitle = "kbs";
var foot_height = padding;

var xmlhttp;
var receJSON1 = [];
var receCpu1 = [];
var receMem1 = [];
var receNetwork1 = [];
var receTime1 = [];
var receID1 = [];
var receAmount;
var finalTime = 0;

var ajaxReq = new AjaxRequest();
var xmlhttp2;

var dataset = [];
var xMarks = [];
var datasetm = [];
var xMarksm = [];
var datasetn = [];
var xMarksn = [];
var w = 500;
var h = 225;


//create data

getData();
//-----------------------------for cpu chart
//create svg

var svg = d3.select("#chart_cpu")
    .attr("width",w)
    .attr("height",h);

//add background
svg.append("g")
    .append("rect")
    .attr("x",0)
    .attr("y",0)
    .attr("width",w)
    .attr("height",h)
    .style("fill","#FFF")
    .style("stroke-width",2)
    .style("stroke","#E7E7E7");

//add titles

if(chart1_title != ""){
    svg.append("g")
        .append("text")
        .text(chart1_title)
        .attr("class","chart1_title")
        .attr("x",w/2)
        .attr("y",head_height);

}

if(chart1_subtitle != ""){
    svg.append("g")
        .append("text")
        .text(chart1_subtitle)
        .attr("class","chart1_subtitle")
        .attr("x",20)
        .attr("y",20);

}


//add scaleor

var xScale = d3.scale.linear()
    .domain([0,dataset.length-1])
    .range([padding,w-padding]);

var yScale = d3.scale.linear()
    .domain([0,100])
    .range([h-padding,padding]);

//define inner line

var xInner = d3.svg.axis()
    .scale(xScale)
    .tickSize(-(h-padding*2),0,0)
    .orient("bottom")
    .ticks(dataset.length);

svg.append("g")
    .attr("class","chart1_inner_line")
    .attr("transform","translate(0,"+(h-padding)+")")
    .call(xInner)
    .selectAll("text")
    .text("");

var yInner = d3.svg.axis()
    .scale(yScale)
    .tickSize(-(w-padding*2),0,0)
    .tickFormat("")
    .orient("left")
    .ticks(10);

svg.append("g")
    .attr("class","chart1_inner_line")
    .attr("transform","translate("+padding+",0)")
    .call(yInner);


//define axis

var xAxis = d3.svg.axis()
    .scale(xScale)
    .orient("bottom")
    .ticks(dataset.length);

//define axis bar

var xBar = svg.append("g")
    .attr("class","axis")
    .attr("transform","translate(0,"+(h-padding)+")")
    .call(xAxis)
    .selectAll("text")
    .text(function(d){
        return xMarks[d];
    });


//define y axis
var yAxis = d3.svg.axis()
    .scale(yScale)
    .orient("left")
    .ticks(10);

//define axis bar

var yBar = svg.append("g")
    .attr("class","axis")
    .attr("transform","translate("+padding+",0)")
    .call(yAxis);


//add lines

var lineFunction = d3.svg.line()
    .interpolate("linear")
    .x(function(d,i){
        return xScale(i);
    })
    .y(function(d){
        return yScale(d);
    });

//add polyline


var path = svg.append("path")
    .attr("d",lineFunction(dataset))
    .attr("class","thepath")
    .style("fill","none")
    .style("stroke-width",2)
    .style("stroke","#F00")
    .style("stroke-opacity",0.9);

//-----------------------------for cpu chart end-----------------


//-----------------------------for mem chart------------------------
//create svg

var svg_m = d3.select("#chart_mem")
    .attr("width",w)
    .attr("height",h);

//add background
svg_m.append("g")
    .append("rect")
    .attr("x",0)
    .attr("y",0)
    .attr("width",w)
    .attr("height",h)
    .style("fill","#FFF")
    .style("stroke-width",2)
    .style("stroke","#E7E7E7");

//add titles

if(chartm_title != ""){
    svg_m.append("g")
        .append("text")
        .text(chartm_title)
        .attr("class","chart1_title")
        .attr("x",w/2)
        .attr("y",head_height);

}

if(chartm_subtitle != ""){
    svg_m.append("g")
        .append("text")
        .text(chartm_subtitle)
        .attr("class","chart1_subtitle")
        .attr("x",20)
        .attr("y",20);

}


//add scaleor

var xScalem = d3.scale.linear()
    .domain([0,datasetm.length-1])
    .range([padding,w-padding]);

var yScalem = d3.scale.linear()
    .domain([0,100])
    .range([h-padding,padding]);

//define inner line

var xInnerm = d3.svg.axis()
    .scale(xScalem)
    .tickSize(-(h-padding*2),0,0)
    .orient("bottom")
    .ticks(datasetm.length);


svg_m.append("g")
    .attr("class","chart1_inner_line")
    .attr("transform","translate(0,"+(h-padding)+")")
    .call(xInnerm)
    .selectAll("text")
    .text("");

var yInnerm = d3.svg.axis()
    .scale(yScalem)
    .tickSize(-(w-padding*2),0,0)
    .tickFormat("")
    .orient("left")
    .ticks(10);

svg_m.append("g")
    .attr("class","chart1_inner_line")
    .attr("transform","translate("+padding+",0)")
    .call(yInnerm);


//define axis

var xAxism = d3.svg.axis()
    .scale(xScalem)
    .orient("bottom")
    .ticks(datasetm.length);

//define axis bar

var xBarm = svg_m.append("g")
    .attr("class","axis")
    .attr("transform","translate(0,"+(h-padding)+")")
    .call(xAxism)
    .selectAll("text")
    .text(function(d){
        return xMarksm[d];
    });


//define y axis
var yAxism = d3.svg.axis()
    .scale(yScalem)
    .orient("left")
    .ticks(10);

//define axis bar

var yBarm = svg_m.append("g")
    .attr("class","axis")
    .attr("transform","translate("+padding+",0)")
    .call(yAxism);


//add lines


var lineFunctionm = d3.svg.line()
    .interpolate("linear")
    .x(function(d,i){
        return xScalem(i);
    })
    .y(function(d){
        return yScalem(d);
    });

//add polyline


var pathm = svg_m.append("path")
    .attr("d",lineFunctionm(datasetm))
    .attr("class","thepath")
    .style("fill","none")
    .style("stroke-width",2)
    .style("stroke","#0F0")
    .style("stroke-opacity",0.9);

//-----------------------------for mem chart end-----------------



//-----------------------------for network chart------------------------
//create svg

var svg_n = d3.select("#chart_net")
    .attr("width",w)
    .attr("height",h);

//add background
svg_n.append("g")
    .append("rect")
    .attr("x",0)
    .attr("y",0)
    .attr("width",w)
    .attr("height",h)
    .style("fill","#FFF")
    .style("stroke-width",2)
    .style("stroke","#E7E7E7");

//add titles

if(chartn_title != ""){
    svg_n.append("g")
        .append("text")
        .text(chartn_title)
        .attr("class","chart1_title")
        .attr("x",w/2)
        .attr("y",head_height);

}

if(chartn_subtitle != ""){
    svg_n.append("g")
        .append("text")
        .text(chartn_subtitle)
        .attr("class","chart1_subtitle")
        .attr("x",20)
        .attr("y",20);

}


//add scaleor

var xScalen = d3.scale.linear()
    .domain([0,datasetn.length-1])
    .range([padding,w-padding]);

var yScalen = d3.scale.linear()
    .domain([0,100])
    .range([h-padding,padding]);

//define inner line

var xInnern = d3.svg.axis()
    .scale(xScalen)
    .tickSize(-(h-padding*2),0,0)
    .orient("bottom")
    .ticks(datasetn.length);


svg_n.append("g")
    .attr("class","chart1_inner_line")
    .attr("transform","translate(0,"+(h-padding)+")")
    .call(xInnern)
    .selectAll("text")
    .text("");

var yInnern = d3.svg.axis()
    .scale(yScalen)
    .tickSize(-(w-padding*2),0,0)
    .tickFormat("")
    .orient("left")
    .ticks(10);

svg_n.append("g")
    .attr("class","chart1_inner_line")
    .attr("transform","translate("+padding+",0)")
    .call(yInnern);


//define axis

var xAxisn = d3.svg.axis()
    .scale(xScalen)
    .orient("bottom")
    .ticks(datasetn.length);

//define axis bar

var xBarn = svg_n.append("g")
    .attr("class","axis")
    .attr("transform","translate(0,"+(h-padding)+")")
    .call(xAxisn)
    .selectAll("text")
    .text(function(d){
        return xMarksn[d];
    });


//define y axis
var yAxisn = d3.svg.axis()
    .scale(yScalen)
    .orient("left")
    .ticks(10);

//define axis bar

var yBarn = svg_n.append("g")
    .attr("class","axis")
    .attr("transform","translate("+padding+",0)")
    .call(yAxisn);


//add lines


var lineFunctionn = d3.svg.line()
    .interpolate("linear")
    .x(function(d,i){
        return xScalen(i);
    })
    .y(function(d){
        return yScalen(d);
    });

//add polyline


var pathn = svg_n.append("path")
    .attr("d",lineFunctionn(datasetn))
    .attr("class","thepath")
    .style("fill","none")
    .style("stroke-width",2)
    .style("stroke","#00F")
    .style("stroke-opacity",0.9);

//-----------------------------for network chart end-----------------


//add point
/*
svg.selectAll("circle")
    .data(dataset)
    .enter()
    .append("circle")
    .attr("cx",function(d,i){
        return xScale(i);
    })
    .attr("cy",function(d){
        return yScale(d);
    })
    .attr("r",5)
    .attr("fill","green");
*/


var timeNum;

function getData(){
    var dataNum = 40;
    dataset = [];
    xMarks = [];
    datasetm = [];
    xMarksm = [];
    datasetn = [];
    xMarksn = [];

    for(var i = 1;i<dataNum;i++){
        //dataset.push(Math.round(Math.random()*h));
        dataset.push(0);
        xMarks.push("");
        datasetm.push(0);
        xMarksm.push("");
        datasetn.push(0);
        xMarksn.push("");
        timeNum = 0;
    }

}

function changeData(){


    for(var i = 0;i<receAmount;i++){
        dataset.shift();
        datasetm.shift();
        datasetn.shift();
        //dataset.push(Math.round(Math.random()*h));
        dataset.push(receCpu1[i].cpu);
        datasetm.push(receMem1[i].mem);
        datasetn.push(receNetwork1[i].network);
        finalTime = receTime1[i].timestamp;

        //alert(finalTime);
        xMarks.shift();
        xMarksm.shift();
        xMarksn.shift();
        if(receID1[i].ID % 5 == 0){
            var newDate = new Date();
            newDate.setTime(receTime1[i].timestamp);
            xMarks.push(newDate.getHours()+":"+newDate.getMinutes()+":"+newDate.getSeconds());
            xMarksm.push(newDate.getHours()+":"+newDate.getMinutes()+":"+newDate.getSeconds());
            xMarksn.push(newDate.getHours()+":"+newDate.getMinutes()+":"+newDate.getSeconds());

        }else{
            xMarks.push("");
            xMarksm.push("");
            xMarksn.push("");
        }
    }


}

function drawChart() {


    changeData();


    //yScale = d3.scale.linear()
    //		.domain([0, d3.max(dataset)])
    //		.range([h - padding, padding]);


    //----------------------------for cpu chart----------------------------
    yAxis = d3.svg.axis()
        .scale(yScale)
        .orient("left")
        .ticks(10);

    xScale = d3.scale.linear()
        .domain([0,dataset.length-1])
        .range([padding,w-padding]);

    xAxis = d3.svg.axis()
        .scale(xScale)
        .orient("bottom")
        .ticks(dataset.length);

    xBar.transition()
        .duration(300)
        .text(function(d){

                return xMarks[d];


        })
        .call(xAxis);

    yBar.transition()
        .duration(300)
        .call(yAxis);

    path//.transition()
        //.duration(1000)
        .attr("d", lineFunction(dataset));

    //--------------------------------for cpu chart end--------------------------


    //----------------------------for mem chart----------------------------
    yAxism = d3.svg.axis()
        .scale(yScale)
        .orient("left")
        .ticks(10);

    xScalem = d3.scale.linear()
        .domain([0,datasetm.length-1])
        .range([padding,w-padding]);

    xAxism = d3.svg.axis()
        .scale(xScalem)
        .orient("bottom")
        .ticks(datasetm.length);

    xBarm.transition()
        .duration(300)
        .text(function(d){

            return xMarksm[d];


        })
        .call(xAxism);

    yBarm.transition()
        .duration(300)
        .call(yAxism);

    pathm//.transition()
        //.duration(1000)
        .attr("d", lineFunctionm(datasetm));

    //--------------------------------for mem chart end--------------------------

    //----------------------------for network chart----------------------------
    yAxisn = d3.svg.axis()
        .scale(yScalen)
        .orient("left")
        .ticks(10);

    xScalen = d3.scale.linear()
        .domain([0,datasetn.length-1])
        .range([padding,w-padding]);

    xAxisn = d3.svg.axis()
        .scale(xScalen)
        .orient("bottom")
        .ticks(datasetn.length);

    xBarn.transition()
        .duration(300)
        .text(function(d){

            return xMarksn[d];


        })
        .call(xAxisn);

    yBarn.transition()
        .duration(300)
        .call(yAxisn);

    pathn//.transition()
        //.duration(1000)
        .attr("d", lineFunctionn(datasetn));

    //--------------------------------for network chart end--------------------------
/*
    svg.selectAll("circle")
        .data(dataset)
        //.transition()
        //.duration(1000)
        .attr("cy", function (d) {
            return yScale(d);
        });*/

}

                   //*********ajax********
function CreateXHR(){
    if (window.XMLHttpRequest)
    {
        //对浏览器 IE7+, Firefox, Chrome, Opera, Safari
        return new XMLHttpRequest();
    }
    else
    {
        //对浏览器 IE6, IE5
        return new ActiveXObject("Microsoft.XMLHTTP");
    }
}
/*
xmlhttp = CreateXHR();

xmlhttp.open("GET","/HelloServlet",true);
xmlhttp.send();

xmlhttp.onreadystatechange = function(){
    if(xmlhttp.readyState == 4 && xmlhttp.status == 200){
        var getedJSON = xmlhttp.responseText;
        var obj = JSON.parse(getedJSON);
        receAmount = obj.jamount;

            receNetwork1 = obj.jnetwork1;
            receMem1 = obj.jmem1;
            receCpu1 = obj.jcpu1;
            receTime1 = obj.jtimestamp1;
            receID1 = obj.jID1;



    }

        drawChart();
    }

*/

str = "name=unhand" + "&timestamp=" + finalTime;

CreateXMLHttpRequest();
xmlhttp2.onreadystatechange = callhandle;
//xmlhttp.open("GET","Default.aspx?goback=yes&arg=" + arg,true);
xmlhttp2.open("POST","/HelloServlet",true);

xmlhttp2.setRequestHeader("Content-Length",str.length);
xmlhttp2.setRequestHeader("Content-Type","application/x-www-form-urlencoded;");  //鐢≒OST鐨勬椂鍊欎竴瀹氳鏈夎繖鍙�

xmlhttp2.send(str);
setTimeout(function(){
/*
    xmlhttp = CreateXHR();

    xmlhttp.open("GET","/HelloServlet",true);
    xmlhttp.send();

    xmlhttp.onreadystatechange = function(){
        if(xmlhttp.readyState == 4 && xmlhttp.status == 200){
            var getedJSON = xmlhttp.responseText;
            var obj = JSON.parse(getedJSON);
            receJSON = obj.value;
            drawChart();
        }
    }*/

    str = "name=unhand" + "&timestamp=" + finalTime;

    CreateXMLHttpRequest();
    xmlhttp2.onreadystatechange = callhandle;
    //xmlhttp.open("GET","Default.aspx?goback=yes&arg=" + arg,true);
    xmlhttp2.open("POST","/HelloServlet",true);

    xmlhttp2.setRequestHeader("Content-Length",str.length);
    xmlhttp2.setRequestHeader("Content-Type","application/x-www-form-urlencoded;");  //鐢≒OST鐨勬椂鍊欎竴瀹氳鏈夎繖鍙�

    xmlhttp2.send(str);



    setTimeout(arguments.callee,5000);
},5000);

function CMD(value){

    alert("cmd");
    var command = value;
    str = "command=" + command;

    CreateXMLHttpRequest();
    xmlhttp2.onreadystatechange = callhandle;
    //xmlhttp.open("GET","Default.aspx?goback=yes&arg=" + arg,true);
    xmlhttp2.open("POST","/CMDinset",true);

    xmlhttp2.setRequestHeader("Content-Length",str.length);
    xmlhttp2.setRequestHeader("Content-Type","application/x-www-form-urlencoded;");  //鐢≒OST鐨勬椂鍊欎竴瀹氳鏈夎繖鍙�

    xmlhttp2.send(str);
}

function CreateXMLHttpRequest()
{
    if (window.ActiveXObject)
    {
        xmlhttp2 = new ActiveXObject("Microsoft.XMLHTTP");
    }
    else if (window.XMLHttpRequest)
    {
        xmlhttp2 = new XMLHttpRequest();
    }
}
function callhandle()
{


    if(xmlhttp2.readyState == 4 && (xmlhttp2.status == 200|| xmlhttp2.status == 0)){
        var getedJSON = xmlhttp2.responseText;
        var obj = JSON.parse(getedJSON);
        receAmount = obj.jamount;

        receNetwork1 = obj.jnetwork1;
        receMem1 = obj.jmem1;
        receCpu1 = obj.jcpu1;
        receTime1 = obj.jtimestamp1;
        receID1 = obj.jID1;


        drawChart();
    }



}

//---------------------/chart cpu----------------------------------------------------
</script>

</body>
</html>
