<!DOCTYPE html>
<html>
<!-------------------head part---------------->
<head lang="en">
	<meta charset="UTF-8">
	<title>VIMMS dashboard</title>
    <script type="text/javascript" src="d3/d3.js"></script>
    <link type="text/css" rel="stylesheet" href="dashboard.css">

</head>
<!------------------body part----------------->
<body>
<!------------------header part--------------->
    <header id="top_header">
        <!-- left side-->
        <span id="LOGO"><span id="LOGO_white">V I</span> M M S</span>
        <!-- right side-->
        <div id="LOGO_table">
            <div id="LOGO_row">
                <div id="LOGO_message" class="LOGO_cell">
                    <img id="top_mes" src="image/top_mes.png" height="24"
                         onmouseover="top_mes_over();" onmouseout="top_mes_out();">
                </div>
                <div id="LOGO_email" class="LOGO_cell">
                    <img id="top_email" src="image/top_email.png" height="24"
                         onmouseover="top_email_over();" onmouseout="top_email_out();">
                </div>
                <div id="LOGO_person" class="LOGO_cell">
                    <span id="person">YANG YU</span>
                </div>
                <div id="LOGO_menu" class="LOGO_cell">
                    <img id="top_menu" src="image/top_menu.png" height="24"
                         onmouseover="top_menu_over();" onmouseout="top_menu_out();">
                </div>
            </div>
        </div>
    </header>
<!----------------navigator part------------------>
<div id="navigator">
    <div id="navi_ul">
        <!-- menu part-->
        <div id="none">
            <img id="none_img" src="image/nav_menu.png" height="24">
        </div>
        <!-- search part-->
        <div id="search">
            <input type="text" id="input_search" placeholder="Search...">
            <img src="image/nav_search.png" height="12">
        </div>
        <!-- user resources part-->
        <div id="resources">
            <div id="DashBoard" class="resources_row">
                <div class="resources_cell cell_img"><img src="image/nav_home.png" height="24"></div>
                <div class="resources_cell cell_word">Dashboard</div>
                <div class="resources_cell cell_res"><</div>
            </div>
            <div id="VM1" class="resources_row">
                <div class="resources_cell cell_img"><img src="image/nav_vm.png" height="24"></div>
                <div class="resources_cell cell_word">VM1</div>
                <div class="resources_cell cell_res"><</div>
            </div>
            <div id="VM2" class="resources_row">
                <div class="resources_cell cell_img"><img src="image/nav_vm.png" height="24"></div>
                <div class="resources_cell cell_word">VM2</div>
                <div class="resources_cell cell_res"><</div>
            </div>
            <div id="VM3" class="resources_row">
                <div class="resources_cell cell_img"><img src="image/nav_vm.png" height="24"></div>
                <div class="resources_cell cell_word">VM3</div>
                <div class="resources_cell cell_res"><</div>
            </div>
            <div id="VM4" class="resources_row">
                <div class="resources_cell cell_img"><img src="image/nav_vm.png" height="24"></div>
                <div class="resources_cell cell_word">VM4</div>
                <div class="resources_cell cell_res"><</div>
            </div>

        </div>
    </div>
</div>
<!---------------------------panel part--------------------------->
<div id="PANEL">
    <div id="PANEL_outline">
        <!-- --------------------header----------------------------------->
        <header id="PANEL_header">
            <span id="PANEL_header_word">DASHBOARD</span>
            <span id="PANEL_header_word2">statistics and more</span>
            <img src="image/panel_config.png" id="PANEL_header_img">
        </header>
        <!-- ------------------------navigator------------------------->
        <div id="PANEL_navigator">
            <span id="PANEL_nav_path">
                <img src="image/panel_home.png" id="PANEL_path_img" height="16">
                <span id="PANEL_path_word">Home  >  Dashboard</span>
            </span>
            <span id="PANEL_calendar">
                <img src="image/panel_calendar.png" id="PANEL_cal_img" height="16">
                <span id="PANEL_cal_word">Dates</span>
                <img src="image/panel_cal_down.png" id="PANEL_cal_img2" height="16">
            </span>

        </div>
        <!------------------------ data table------------------------------>
        <div id="PANEL_data">

                <!-- VM1-->
                <div id="PANEL_VM1" class="firstrow_cell">
                    <div id="PANEL_VM1_up" class="panel_up">
                        <img src="image/panel_data_pm.png" id="data_vm1_img" class="data_vm_img"
                             onclick="toVmLocation('1');">
                        <span id="panel_vm1_word" class="panel_word">
                            <span id="panel_vm1_bigword" class="panel_bigword">STATUS</span><br>
                            <span id="panel_vm1_smallword" class="panel_smallword">Reading...</span>
                        </span>
                        <span id="panel_vm1_name" class="panel_name"
                              onclick="toVmLocation('1');">PM1</span>
                    </div>
                    <div id="PANEL_VM1_down" class="panel_down">
                        <!--<span id="panel_vm1_downword" class="panel_downword">View more</span>-->
                        <nav class="nav">
                            <ul class="nav_menu">
                                <li class="nav_menu-item"><a  target="_blank">Control<img src="image/data_right.png" class="data_right_img"></a>
                                    <ul id="nav_submenu_1" class="nav_submenu">
                                        <li class="nav_submenu-item"> <a onclick="CMD('shutdown','PM1');" target="_blank">Shutdown</a></li>
                                        <li class="nav_submenu-item"> <a onclick="CMD('restart','PM1');" target="_blank">Restart</a></li>
                                        <li class="nav_submenu-item"> <a  onclick="CMD('stop','PM1');" target="_blank">Stop</a></li>
                                    </ul>
                                </li>
                                </ul>
                        </nav>
                        <!--<img src="image/data_right.png" class="data_right_img">-->
                    </div>
                </div>
                <!-- VM2-->
                <div id="PANEL_VM2" class="firstrow_cell">
                    <div id="PANEL_VM2_up" class="panel_up">
                        <img src="image/panel_data_pm.png" id="data_vm2_img" class="data_vm_img"
                            onclick="toVmLocation('2');">
                        <span id="panel_vm2_word" class="panel_word">
                            <span id="panel_vm2_bigword" class="panel_bigword">STATUS</span><br>
                            <span id="panel_vm2_smallword" class="panel_smallword">Reading...</span>
                        </span>
                        <span id="panel_vm2_name" class="panel_name"
                              onclick="toVmLocation('2');">PM2</span>
                    </div>
                    <div id="PANEL_VM2_down" class="panel_down">
                        <nav class="nav">
                            <ul class="nav_menu">
                                <li class="nav_menu-item"><a  target="_blank">Control<img src="image/data_right.png" class="data_right_img"></a>
                                    <ul id="nav_submenu_2" class="nav_submenu">
                                        <li class="nav_submenu-item"> <a onclick="CMD('shutdown','PM2');" target="_blank">Shutdown</a></li>
                                        <li class="nav_submenu-item"> <a onclick="CMD('restart','PM2');" target="_blank">Restart</a></li>
                                        <li class="nav_submenu-item"> <a  onclick="CMD('stop','PM2');" target="_blank">Stop</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
                <!-- VM3-->
                <div id="PANEL_VM3" class="firstrow_cell">
                    <div id="PANEL_VM3_up" class="panel_up">
                        <img src="image/panel_data_vm.png" id="data_vm3_img" class="data_vm_img"
                             onclick="toVmLocation('3');">
                        <span id="panel_vm3_word" class="panel_word">
                            <span id="panel_vm3_bigword" class="panel_bigword">STATUS</span><br>
                            <span id="panel_vm3_smallword" class="panel_smallword">Reading...</span>
                        </span>
                        <span id="panel_vm3_name" class="panel_name"
                              onclick="toVmLocation('3');">VM1</span>
                    </div>
                    <div id="PANEL_VM3_down" class="panel_down">
                        <nav class="nav">
                            <ul class="nav_menu">
                                <li class="nav_menu-item"><a  target="_blank">Control<img src="image/data_right.png" class="data_right_img"></a>
                                    <ul id="nav_submenu_3" class="nav_submenu">
                                        <li class="nav_submenu-item"> <a onclick="CMD('shutdown','VM1');" target="_blank">Shutdown</a></li>
                                        <li class="nav_submenu-item"> <a onclick="CMD('restart','VM1');" target="_blank">Restart</a></li>
                                        <li class="nav_submenu-item"> <a  onclick="CMD('stop','VM1');" target="_blank">Stop</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
                <!-- VM4-->
                <div id="PANEL_VM4" class="firstrow_cell">
                    <div id="PANEL_VM4_up" class="panel_up">
                        <img src="image/panel_data_vm.png" id="data_vm4_img" class="data_vm_img"
                             onclick="toVmLocation('4');">
                        <span id="panel_vm4_word" class="panel_word">
                            <span id="panel_vm4_bigword" class="panel_bigword">STATUS</span><br>
                            <span id="panel_vm4_smallword" class="panel_smallword">Reading...</span>
                        </span>
                        <span id="panel_vm4_name" class="panel_name"
                              onclick="toVmLocation('4');">VM2</span>
                    </div>
                    <div id="PANEL_VM4_down" class="panel_down">
                        <nav class="nav">
                            <ul class="nav_menu">
                                <li class="nav_menu-item"><a  target="_blank">Control<img src="image/data_right.png" class="data_right_img"></a>
                                    <ul id="nav_submenu_4" class="nav_submenu">
                                        <li class="nav_submenu-item"> <a onclick="CMD('shutdown','VM2');" target="_blank">Shutdown</a></li>
                                        <li class="nav_submenu-item"> <a onclick="CMD('restart','VM2');" target="_blank">Restart</a></li>
                                        <li class="nav_submenu-item"> <a  onclick="CMD('sleep','VM2');" target="_blank">Sleep</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>

            </div>
        </div>



</div>

<script type="text/javascript">
//-----------------------------hover process----------------------------------------
    function top_mes_over(){
        document.getElementById("top_mes").src = "image/top_mes2.png";
    }

    function top_mes_out(){

        document.getElementById("top_mes").src = "image/top_mes.png";
    }

    function top_email_over(){
        document.getElementById("top_email").src = "image/top_email2.png";
    }

    function top_email_out(){

        document.getElementById("top_email").src = "image/top_email.png";
    }


    function top_menu_over(){
        document.getElementById("top_menu").src = "image/top_menu2.png";
    }

    function top_menu_out(){

        document.getElementById("top_menu").src = "image/top_menu.png";
    }


                   //*********ajax********
function CreateXHR(){
    if (window.XMLHttpRequest)
    {
        //对浏览器 IE7+, Firefox, Chrome, Opera, Safari
        return new XMLHttpRequest();
    }
    else
    {
        //对浏览器 IE6, IE5
        return new ActiveXObject("Microsoft.XMLHTTP");
    }
}

//---------ajax for getting status task



var jVM1_name = "";
var jVM1_status = "";
var jVM2_name = "";
var jVM2_status = "";
var jPM1_name = "";
var jPM1_status = "";
var jPM2_name = "";
var jPM2_status = "";
var jTime = "";

var xmlhttp3 = CreateXHR();
xmlhttp3.open("GET","/STATUSget",true);
xmlhttp3.send();

xmlhttp3.onreadystatechange = function(){
    if(xmlhttp3.readyState == 4 && xmlhttp3.status == 200){
        var getedJSON = xmlhttp3.responseText;
        var obj = JSON.parse(getedJSON);


        jVM1_name = obj.vm1_name;
         jVM1_status = obj.vm1_status;
         jVM2_name = obj.vm2_name;
         jVM2_status = obj.vm2_status;
         jPM1_name = obj.pm1_name;
         jPM1_status =  obj.pm1_status;
         jPM2_name =  obj.pm2_name;
         jPM2_status =  obj.pm2_status;
        jTime = obj.time_now;

        document.getElementById("panel_vm1_smallword").innerText = jPM1_name + "\n" + jPM1_status.toUpperCase();
        document.getElementById("panel_vm2_smallword").innerText = jPM2_name +  "\n" + jPM2_status.toUpperCase();
        document.getElementById("panel_vm3_smallword").innerText = jVM1_name +  "\n"  + jVM1_status.toUpperCase();
        document.getElementById("panel_vm4_smallword").innerText = jVM2_name +  "\n"  + jVM2_status.toUpperCase();
        document.getElementById("PANEL_cal_word").innerText = jTime;

        for(var i = 1;i<=4;i++){
            if(document.getElementById("panel_vm"+i+"_smallword").innerText.indexOf("TERMINATED")>-1){
                document.getElementById("PANEL_VM"+i).style.color = "#333333";

            }else if(document.getElementById("panel_vm"+i+"_smallword").innerText.indexOf("RUNNING")>-1){
                document.getElementById("PANEL_VM"+i).style.color = "white";

            }else{

            }
        }


    }
}

function toVmLocation(locationNumber){
    if(document.getElementById("panel_vm"+locationNumber+"_smallword").innerText.indexOf("TERMINATED")>-1){
        alert("Sorry, the panel is Terminated");
    }else if(document.getElementById("panel_vm"+locationNumber+"_smallword").innerText.indexOf("RUNNING")>-1) {
        window.location.href = "VM" + locationNumber + ".html";
    }else{

    }
}


var ajaxReq = new AjaxRequest();
var xmlhttp2;
//---------ajax for the command task

function CMD(value,name){
    var command = value;
    var truename = "";

    switch (name){
        case "PM1": truename = jPM1_name;

            break;
        case "PM2": truename = jPM2_name;

            break;
        case "VM1": truename = jVM1_name;

            break;
        case "VM2": truename = jVM2_name;

            break;
        default :alert("error");
            break;
    }
    str = "command=" + command + "&name=" + truename;


    CreateXMLHttpRequest();
    xmlhttp2.onreadystatechange = callhandle;
    //xmlhttp.open("GET","Default.aspx?goback=yes&arg=" + arg,true);
    xmlhttp2.open("POST","/CMDinset",true);

    xmlhttp2.setRequestHeader("Content-Length",str.length);
    xmlhttp2.setRequestHeader("Content-Type","application/x-www-form-urlencoded;");  //鐢≒OST鐨勬椂鍊欎竴瀹氳鏈夎繖鍙�

    xmlhttp2.send(str);
}

function CreateXMLHttpRequest()
{
    if (window.ActiveXObject)
    {
        xmlhttp2 = new ActiveXObject("Microsoft.XMLHTTP");
    }
    else if (window.XMLHttpRequest)
    {
        xmlhttp2 = new XMLHttpRequest();
    }
}
function callhandle()
{

    if (xmlhttp2.readyState == 4)
    {
        if(xmlhttp2.status == 200)
        {
            var jsonstr = xmlhttp2.responseText;
            var obj = JSON.parse(jsonstr);

            if(obj.value != "error"){

                alert(obj.value);
            }else{
                alert("Failure");
            }
        }
    }
}

//---------------------/chart cpu----------------------------------------------------
</script>

</body>
</html>
